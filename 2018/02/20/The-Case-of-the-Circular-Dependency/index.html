



  




<!doctype html>
<html
  lang="en-us"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>The Case of the Circular Dependency &middot; Eric&#39;s Web.site</title>
    <meta name="title" content="The Case of the Circular Dependency &middot; Eric&#39;s Web.site" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.9602fe0216290b9ff0322c1fd14e88ab9fc0a13741f4de563f67831708d72bb2.css"
    integrity="sha256-lgL&#43;AhYpC5/wMiwf0U6Iq5/AoTdB9N5WP2eDFwjXK7I="
  />
  
  
  
  
  
  
  
  <meta
    name="description"
    content="
      
        As some know, I keep a personal server. I&rsquo;ve developed tales of my (mis)adventures and the things I&rsquo;ve learned from them. I found this one humorous. Why? The root cause.
My hard drive is too fast.
I&rsquo;ll start at the beginning. If you&rsquo;re not into computers, I&rsquo;ll explain things in a way that hopefully anyone can understand, but to be honest I&rsquo;m not sure if you&rsquo;ll get a lot out of it.
      
    "
  />
  
  
  
  <link rel="canonical" href="https://ericsweb.site/2018/02/20/The-Case-of-the-Circular-Dependency/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="https://ericsweb.site/2018/02/20/The-Case-of-the-Circular-Dependency/">
  <meta property="og:site_name" content="Eric&#39;s Web.site">
  <meta property="og:title" content="The Case of the Circular Dependency">
  <meta property="og:description" content="As some know, I keep a personal server. I&amp;rsquo;ve developed tales of my (mis)adventures and the things I&amp;rsquo;ve learned from them. I found this one humorous. Why? The root cause.
My hard drive is too fast.
I&amp;rsquo;ll start at the beginning. If you&amp;rsquo;re not into computers, I&amp;rsquo;ll explain things in a way that hopefully anyone can understand, but to be honest I&amp;rsquo;m not sure if you&amp;rsquo;ll get a lot out of it.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
  <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-02-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2018-02-20T00:00:00+00:00">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="The Case of the Circular Dependency">
<meta name="twitter:description" content="As some know, I keep a personal server. I&rsquo;ve developed tales of my (mis)adventures and the things I&rsquo;ve learned from them. I found this one humorous. Why? The root cause.
My hard drive is too fast.
I&rsquo;ll start at the beginning. If you&rsquo;re not into computers, I&rsquo;ll explain things in a way that hopefully anyone can understand, but to be honest I&rsquo;m not sure if you&rsquo;ll get a lot out of it.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "The Case of the Circular Dependency",
    "headline": "The Case of the Circular Dependency",
    
    "abstract": "As some know, I keep a personal server. I\u0026rsquo;ve developed tales of my (mis)adventures and the things I\u0026rsquo;ve learned from them. I found this one humorous. Why? The root cause.\nMy hard drive is too fast.\nI\u0026rsquo;ll start at the beginning. If you\u0026rsquo;re not into computers, I\u0026rsquo;ll explain things in a way that hopefully anyone can understand, but to be honest I\u0026rsquo;m not sure if you\u0026rsquo;ll get a lot out of it.",
    "inLanguage": "en-us",
    "url" : "https:\/\/ericsweb.site\/2018\/02\/20\/The-Case-of-the-Circular-Dependency\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2018",
    "dateCreated": "2018-02-20T00:00:00\u002b00:00",
    "datePublished": "2018-02-20T00:00:00\u002b00:00",
    
    "dateModified": "2018-02-20T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1745"
  }
  </script>


  
  
  
  
  






  
  
  
  
  
  
  



  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Eric&rsquo;s Web.site</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/posts/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >All Posts</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/profile/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >About</span
                    >
                  </a
                >
              
            </li>
          
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
        <ol class="text-sm text-neutral-500 print:hidden dark:text-neutral-400">
  
  
    
  
    
  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/"
      >Index</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class=" inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden inline">
    <a
      class="dark:underline-neutral-600 decoration-neutral-300 hover:underline"
      href="/2018/02/20/The-Case-of-the-Circular-Dependency/"
      >The Case of the Circular Dependency</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        The Case of the Circular Dependency
      </h1>
      
        <div class="mb-12 mt-8 text-base text-neutral-500 print:hidden dark:text-neutral-400">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2018-02-20 00:00:00 &#43;0000 UTC">February 20, 2018</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">9 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <p>As some know, I keep a personal server. I&rsquo;ve developed tales of my (mis)adventures and the things
I&rsquo;ve learned from them. I found this one humorous. Why? The root cause.</p>
<p>My hard drive is <em>too fast</em>.</p>
<hr>
<p>I&rsquo;ll start at the beginning. If you&rsquo;re not into computers, I&rsquo;ll explain things in a way that
hopefully anyone can understand, but to be honest I&rsquo;m not sure if you&rsquo;ll get a lot out of it. In
either case, I hope you&rsquo;ll enjoy it.</p>
<h2 id="the-background" class="relative group">The Background <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-background" aria-label="Anchor">#</a></span></h2><p>So, background on my server setup. The operating system is installed on a medium-quality solid
state drive (SSD). The main appeal of solid state drives is that they&rsquo;re really fast, at the cost of
size. My server is used for a multitude of things – including backups and file, which take up
hundreds of GigaBytes of data. I want it to boot fast, but I also want lots of storage space. The
result is that the operating system is installed on the SSD while large files are stored on an
external USB 3.0 drive. The USB 3.0 drive is fast enough that, for what I use it for, it never
causes substantial slowdowns. The upside of using USB 3.0 is that external drives can get pretty
much as big as you want, but the downside is that USB 3.0 isn&rsquo;t as fast or reliable as a built-in
drive.</p>
<p>The server runs FreeBSD as its operating system, which works pretty well. Since I wanted to learn
more about using it, I did some experimentation with the file system. FreeBSD supports two file
systems – UFS and ZFS. UFS is old and simple, but rock-solid and fast. ZFS has tons of features,
but is very very slightly slower and is considered to be less reliable just because it&rsquo;s younger.
UFS is installed on the SSD for maximum reliability and simplicity, while ZFS is installed on the
USB 3.0 drive for its self-recovery and other features.</p>
<p>I later found out that this setup is kind of stupid, and I should be using ZFS across the board.
But it&rsquo;s more work than I&rsquo;m interested in to reimage my whole machine and fix it, so I&rsquo;m just
going to have to live with its quirks for now.</p>
<h2 id="the-problem" class="relative group">The Problem <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-problem" aria-label="Anchor">#</a></span></h2><p>The problem was simple enough, albeit a bit enigmatic. From time to time, the external drive will
freeze up. The processes that need to access the data on it will try, and get stuck. No data is
retrieved, and no error is triggered. Nothing goes wrong directly until one of my monitors starts
triggering because it can&rsquo;t retrieve test data.</p>
<p>This is strange. FreeBSD still thinks the drive is there. The drive shows as being mounted. But when
I look at the drive&rsquo;s status, it says <code>UNAVAILABLE</code> and shows an unhelpful error message about
something going wrong.</p>
<h2 id="my-first-attempts" class="relative group">My First Attempts <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#my-first-attempts" aria-label="Anchor">#</a></span></h2><p>The first thing I did was try to list the files in the external drive. It hung forever and never
showed me any of my files or folders. Vexing.</p>
<p>I could identify the process that was tied up trying to access the drive by seeing which one my
monitors showed was down. My first attempt was pretty simple, restart the service that ran the
process.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>service restart myservice
</span></span></code></pre></div><p>I waited. And waited. I figured it was trying to figure out what was going on with the drive in
order to clean itself up. But after a while, it was apparent that it was totally stuck with no way
out. So then I tried something a bit nastier. I got the process ID and tried to kill it myself.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kill <span style="color:#ae81ff">9876</span>
</span></span></code></pre></div><p>I waited. And waited. And nothing happened. What that command basically does is tell the process
in question &ldquo;You need to stop. Right now please. Seriously.&rdquo; It almost always works. Sometimes it
doesn&rsquo;t. When it doesn&rsquo;t, there&rsquo;s a fallback that always works.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kill -9 <span style="color:#ae81ff">9876</span>
</span></span></code></pre></div><p>Unlike normal <code>kill</code>, this doesn&rsquo;t ask the process to stop. It tells the operating system to
terminate the process immediately. No being nice, no letting it clean up resources. Just drop
everything it&rsquo;s doing. That&rsquo;s why it can&rsquo;t fail – you&rsquo;re telling the part of the computer that
allows processes to run <strong>at all</strong> to not let that process run anymore.</p>
<p>I waited, and the process didn&rsquo;t stop. That shouldn&rsquo;t happen.</p>
<p>This xkcd comic seemed apt at the time.</p>
<p>





<figure>
    
    








  
    <picture
      class="mx-auto my-0 rounded-md"
      
    >
      
      
      
      
        <source
          
            srcset="/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_330x0_resize_q75_h2_box_3.webp 330w,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_660x0_resize_q75_h2_box_3.webp 660w
            
              ,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_1024x0_resize_q75_h2_box_3.webp 1024w
            
            
              ,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_1320x0_resize_q75_h2_box_3.webp 1320w
            "
          
          sizes="100vw"
          type="image/webp"
        />
      
      <img
        width="1480"
        height="527"
        class="mx-auto my-0 rounded-md"
        alt="Source: xkcd.com"
        loading="lazy" decoding="async"
        
          src="/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_660x0_resize_box_3.png"
          srcset="/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_330x0_resize_box_3.png 330w,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_660x0_resize_box_3.png 660w
          
            ,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_1024x0_resize_box_3.png 1024w
          
          
            ,/2018/02/20/The-Case-of-the-Circular-Dependency/inexplicable_2x_hu40407548427db62cf4e33f4e3acc1286_80624_1320x0_resize_box_3.png 1320w
          "
          sizes="100vw"
        
      />
    </picture>
  


</figure>
</p>
<p>Well, nothing&rsquo;s working. Time to pull out the big guns.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>reboot
</span></span></code></pre></div><p>Here&rsquo;s a note to the Linux/BSD fans out there. If the operating system isn&rsquo;t able to force kill
a process, it can&rsquo;t reboot. The reboot hung my server in a state of purgatory, unable to die
but far from alive.</p>
<p>Ultimately, my solution was to force a restart. You know, when you hold down the power button
until everything stops. This is potentially really bad for your computer, especially if it&rsquo;s in the
middle of writing to the disk, which is what it looks at this point like mine was doing. At this
point, I&rsquo;m prepared for it to be broken when I come back.</p>
<p>I log back in, the drive mounts, and everything is fine. Huh? I list the errors the drive is having.
With ZFS, this is pretty easy, because it actively tracks the problems with it. It&rsquo;s showing two
issues with metadata. I run <code>zfs scrub</code>, which auto-fixes anything wrong. This fixes the issues and
I move on, figuring it was a one-off glitch.</p>
<h2 id="the-second-time" class="relative group">The Second Time <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-second-time" aria-label="Anchor">#</a></span></h2><p>Then it happened again. I remembered the headaches of the time before, and just hard rebooted it
again, feeling bad about doing it, but not wanting to deal with the headache. At some point, I make
a mental note that I should actually figure out how to fix it. That day comes, and the problems
manifest again in the same way they always do. I get googling (and reading the manual) and
eventually try a command I found on the internet: <code>zpool clear</code>. It works again!</p>
<p><code>zpool clear</code> basically just says &ldquo;ignore any issues you&rsquo;ve found, just keep working&rdquo;. It seems odd
to me that the default behavior is to fail as enigmatically as possible, but I&rsquo;m also not willing to
dive deep enough to the C++ source code to try and make a fix, so I left it as-is.</p>
<p>I go to bed, happy that I have a better (if not ideal) solution.</p>
<h2 id="the-third-time" class="relative group">The Third Time <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-third-time" aria-label="Anchor">#</a></span></h2><p>Why, oh why, didn&rsquo;t I write down what I did. Stupid, stupid, stupid Eric. Hard reboot again.</p>
<h2 id="the-fourth-time" class="relative group">The Fourth Time <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-fourth-time" aria-label="Anchor">#</a></span></h2><p>This time, I&rsquo;m going to find the right way to solve it. And then I&rsquo;m going to make a script to do
it for me, called something like <code>fix_zfs</code>. Then I won&rsquo;t miss it again. I rediscover <code>zfs clear</code>,
much more quickly this time, and start working on a script that detects if it&rsquo;s down and clears it
if it is, then runs an auto-repair. I finally have a self-fixing system.</p>
<p>At this point, I&rsquo;ve got a few hints, and can deduce my best guess on what happened that caused this
enigmatic behavior. It looks like the ZFS drive is in a zombie-like state – it&rsquo;s not mounted,
because the file system is inaccessible, but something is in the middle of some sort of operation
with it. The process can&rsquo;t stop because it&rsquo;s in the middle of an I/O (input/output) operation and
stopping would be dangerous (in terms of data corruption. The drive can&rsquo;t be fully unmounted because
a process is in the middle of accessing it, and stopping would be dangerous. Luckily, because of how
ZFS works, it can auto-repair those errors.</p>
<p>And so we have our result – a circular dependency. Everything is in gridlock, unable to move because
it would might break things. And nothing can stop it because nothing can move. It&rsquo;s bizarre, and
it&rsquo;s a little bit cool. But the inquisitive mind will ask: <em>why?</em></p>
<h2 id="the-autopsy" class="relative group">The Autopsy <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-autopsy" aria-label="Anchor">#</a></span></h2><p>So, I have something that will detect and fix my problem within 4 minutes of it happening, but why
did it go wrong in the first place? If you guessed that it was because I did something stupid, you
win the prize. At this point, I described my predicament to a friend, and they sent me back (once
again) an apt xkcd comic.</p>
<p>





<figure>
    
    








  
    <picture
      class="mx-auto my-0 rounded-md"
      
    >
      
      
      
      
        <source
          
            srcset="/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_330x0_resize_q75_h2_box_3.webp 330w,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_660x0_resize_q75_h2_box_3.webp 660w
            
              ,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_1024x0_resize_q75_h2_box_3.webp 1024w
            
            
              ,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_1320x0_resize_q75_h2_box_3.webp 1320w
            "
          
          sizes="100vw"
          type="image/webp"
        />
      
      <img
        width="1456"
        height="564"
        class="mx-auto my-0 rounded-md"
        alt="Source: xkcd.com"
        loading="lazy" decoding="async"
        
          src="/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_660x0_resize_box_3.png"
          srcset="/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_330x0_resize_box_3.png 330w,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_660x0_resize_box_3.png 660w
          
            ,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_1024x0_resize_box_3.png 1024w
          
          
            ,/2018/02/20/The-Case-of-the-Circular-Dependency/tv_problems_2x_hu82da081954b828e842c074b1773e55f6_89816_1320x0_resize_box_3.png 1320w
          "
          sizes="100vw"
        
      />
    </picture>
  


</figure>
</p>
<p>So what was I doing that was so stupid? Here&rsquo;s a look at my crontab:</p>
<pre tabindex="0"><code class="language-cron" data-lang="cron">* * * * * zfs mount storage
</code></pre><p>What that&rsquo;s doing is, every minute, it tries to mount my ZFS drive. One of the fun side effects of
this is that if the drive is already mounted, it throws off an error. And when a <code>cron</code> job throws
an error, it sends a local email to the root account. I had over 170,000 emails from that job in
my root account, and they took up about a GigaByte of space. That&rsquo;s not directly related to the
issue, but it is pretty hilariously inept on my part.</p>
<p>What was happening, as best I can tell, is that eventually the <code>zfs mount</code> process interfered in
<em>just</em> the wrong way with the other processes trying to access that drive, and things went wrong.
This is an insane problem caused by an insane solution and all ultimately my fault.</p>
<hr>
<p>Then the solution is obvious, right? Just remove that <code>cron</code> job. Well, there&rsquo;s a problem with that.
Without the <code>cron</code> job, the drive isn&rsquo;t mounted on boot. And if it&rsquo;s not done on boot, then I have
to log in and do it manually, which is <em>such a hassle</em>. Thing is, it <strong>is</strong> supposed to be mounted
on boot. I&rsquo;ve jumped through all the hoops and made 100% sure – it&rsquo;s definitely running the code to
mount all of my ZFS drives on boot. So why aren&rsquo;t they there when I log in?</p>
<p>So I took to IRC, started diving through the boot logs, and going through built-in operating system
files to try to hack something to work. And there it is, buried deep in the time stamps. The
auto-mount is running a few seconds before the USB ports are fully on. That&rsquo;s it – my SSD is booting
up <strong>too fast</strong> for it to work correctly.</p>
<p>Taking to IRC, someone gives me a helpful line to add to <code>/boot/loader.conf</code> (the settings for
booting up).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">kern.cam.boot_delay</span><span style="color:#f92672">=</span><span style="color:#e6db74">10000</span>
</span></span></code></pre></div><p>That&rsquo;s delaying 10 seconds (10,000 milliseconds) before starting the bootup processes.</p>
<p>And when I say computers are the work of the Devil, that&rsquo;s what I mean.</p>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
    <div class="place-self-center">
      
      
      <div class="text-2xl sm:text-lg">
</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/2018/01/04/Intel-Security-Bug/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >The Intel Disaster</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2018-01-04 00:00:00 &#43;0000 UTC">January 4, 2018</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/2018/03/07/Duplicity/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Duplicity: The Best Free Backup Software</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2018-03-07 00:00:00 &#43;0000 UTC">March 7, 2018</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2024
            
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
    </div>
  </div>
  
  
</footer>

    </div>
  </body>
</html>
