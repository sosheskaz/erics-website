<!DOCTYPE html>
<html
  lang="en-us"
  class="dark"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en-us" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>How to Make a Basic rc.d Script in FreeBSD &middot; Eric&#39;s Web.site</title>
    <meta name="title" content="How to Make a Basic rc.d Script in FreeBSD &middot; Eric&#39;s Web.site" />
  
  <meta name="description" content="Eric Miller&#39;s website to post about Technology, life, and anything else that comes up." />
  
  
  
  <link rel="canonical" href="https://ericsweb.site/2017/03/28/FreeBSD-rcd-Setup/" />
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/schemes/congo.min.b48d6ba061dc77186a2524fb8aac5ac3823b2679a9299ca60325abbccc9c1764c884715f0ba24b4e2776cb3814df4af1f4c854b87207cd5d4c7a254da9b55751.css"
    integrity="sha512-tI1roGHcdxhqJST7iqxaw4I7JnmpKZymAyWrvMycF2TIhHFfC6JLTid2yzgU30rx9MhUuHIHzV1MeiVNqbVXUQ=="
  />
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/compiled/main.min.4076b9cf114dd23cca017f3365e2205a4c9a4b2c0ef4193ccd08883f76e554aa40f674a8f6e77a1b2895be0975ba8e019b0c59996c2eea32e4970ca4d5221653.css"
    integrity="sha512-QHa5zxFN0jzKAX8zZeIgWkyaSywO9Bk8zQiIP3blVKpA9nSo9ud6GyiVvgl1uo4BmwxZmWwu6jLklwyk1SIWUw=="
  />
  
  
  
    <script>
      function loadPreferredAppearance() {
        if (localStorage.preferredAppearance === "dark" || (!("preferredAppearance" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }
      function setPreferredAppearance(scheme) {
        if (scheme == "default") {
          localStorage.removeItem("preferredAppearance");
        } else {
          localStorage.preferredAppearance = scheme;
        }
        loadPreferredAppearance();
      }
      loadPreferredAppearance();
      window.matchMedia("(prefers-color-scheme: dark)").addListener(loadPreferredAppearance);
    </script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="How to Make a Basic rc.d Script in FreeBSD" />
<meta property="og:description" content="Recently, I wanted to make an rc.d script for my FreeBSD server, in order to include TeamCity in the service interface, which in FreeBSD is linked to the rc.d system, as opposed to Linux&rsquo;s systemd system. I was unable to find an easy tutorial, until I stumbled upon a Minecraft forum where I found information on a suitable script. The rc.d system is actually rather nice to work with, and in my opinion, confers more power to the user than does systemd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ericsweb.site/2017/03/28/FreeBSD-rcd-Setup/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-03-28T00:00:00+00:00" /><meta property="og:site_name" content="Eric&#39;s Web.site" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Make a Basic rc.d Script in FreeBSD"/>
<meta name="twitter:description" content="Recently, I wanted to make an rc.d script for my FreeBSD server, in order to include TeamCity in the service interface, which in FreeBSD is linked to the rc.d system, as opposed to Linux&rsquo;s systemd system. I was unable to find an easy tutorial, until I stumbled upon a Minecraft forum where I found information on a suitable script. The rc.d system is actually rather nice to work with, and in my opinion, confers more power to the user than does systemd."/>

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "articleSection": "Posts",
    "name": "How to Make a Basic rc.d Script in FreeBSD",
    "headline": "How to Make a Basic rc.d Script in FreeBSD",
    "description": "Recently, I wanted to make an rc.d script for my FreeBSD server, in order to include TeamCity in the service interface, which in FreeBSD is linked to the rc.d system, as opposed to Linux\u0026rsquo;s systemd system. I was unable to find an easy tutorial, until I stumbled upon a Minecraft forum where I found information on a suitable script. The rc.d system is actually rather nice to work with, and in my opinion, confers more power to the user than does systemd.",
    "inLanguage": "en-us",
    "author" : {
      "@type": "Person",
      "name": "Eric Miller"
    },
    "creator" : {
      "@type": "Person",
      "name": "Eric Miller"
    },
    "copyrightHolder": "Eric Miller",
    "copyrightYear": "2017",
    "dateCreated": "2017-03-28T00:00:00\u002b00:00",
    "datePublished": "2017-03-28T00:00:00\u002b00:00",
    "dateModified": "2017-03-28T00:00:00\u002b00:00",
    "url" : "https:\/\/ericsweb.site\/2017\/03\/28\/FreeBSD-rcd-Setup\/",
    "wordCount": "736",
    "keywords": ["FreeBSD",]
  }
  </script>


  
  
    <meta name="generator" content="Hugo 0.102.0" />
  
  
  <meta name="author" content="Eric Miller" />
  
    
      <link href="https://github.com/sosheskaz/" rel="me" />
    
  
  
  






  
  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  ><header
  class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-800 dark:text-neutral"
>
  
  <div>
    
      <a
        class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small"
        rel="me"
        href="/"
        >Eric&rsquo;s Web.site</a
      >
  </div>
  
  
    <nav>
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small"
              href="/posts/"
              title="Posts"
              >All Posts</a
            >
          </li>
        
          <li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small"
              href="/categories/"
              title="Categories"
              >Categories</a
            >
          </li>
        
          <li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small"
              href="/profile/"
              title="About Me"
              >About</a
            >
          </li>
        
      </ul>
    </nav>
  
</header>
<main class="flex-grow">
  <article class="max-w-prose">
    <header>
      
        <ol class="text-sm text-neutral-400 dark:text-neutral-500">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600"
      href="/"
      >Index</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600"
      href="/2017/03/28/FreeBSD-rcd-Setup/"
      >How to Make a Basic rc.d Script in FreeBSD</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-800 dark:text-neutral">
        How to Make a Basic rc.d Script in FreeBSD
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-400 dark:text-neutral-500">
        





  
  



  

  
  
    
  

  
    
  

  


  <div class="flex flex-row items-center">
    
    
      <time datetime="2017-03-28 00:00:00 &#43;0000 UTC">28 March 2017</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">4 mins</span>
    

    
    
  </div>


      </div>
    </header>
    <section class="prose dark:prose-light">
      <p>Recently, I wanted to make an rc.d script for my FreeBSD server, in order to include TeamCity in the
<code>service</code> interface, which in FreeBSD is linked to the rc.d system, as opposed to Linux&rsquo;s systemd system.
I was unable to find an easy tutorial, until I stumbled upon a Minecraft forum where I found information on
a suitable script. The rc.d system is actually rather nice to work with, and in my opinion, confers more
power to the user than does systemd. This is largely thanks to the <code>/etc/rc.conf</code> file. That said, writing
an rc.d script is relatively easy once you understand how to do it.</p>
<p>The first step is to set up the script that tells <code>service</code> how to understand what to do.
For the purpose of this tutorial, I&rsquo;ll call the service <code>myservice</code>. The first thing
to do is put a script in the <code>/usr/local/etc/rc.d/</code> folder. Name this file the name of your service, in
this case <code>myservice</code>. This means the absolute path of this file is <code>/usr/local/etc/rc.d/myservice</code>.
Finally, make this file executable using <code>chmod +x /usr/local/etc/rc.d/myservice</code>.</p>
<p>Now, edit the file. The first step is the hashbang, which should be put on the first line. This lets the
program know how to start the script independently. Your file should look like this:</p>
<pre><code>#!/bin/sh
</code></pre>
<p>Next, we need to tell it how to use the rc subrouting. This is basically just boilerplate; add
<code>. /etc/rc.subr</code> to the file. Your file will now look like this:</p>
<pre><code>#!/bin/sh

. /etc/rc.subr
</code></pre>
<p>Now, it&rsquo;s time to put in some metadata so that rc.d understands some basic information about this service.
Again, this is, to some extent, boilerplate to work with the rc.d system.</p>
<pre><code>name=&quot;myservice&quot; # How the service will be invoked from service
rcvar=&quot;${name}_enable&quot; # The variable in rc.conf that will allow this service to run
load_rc_config $name # Loads the config file, if relevant.
</code></pre>
<p>Okay, this script is set up to work with the rc.d system. Now, we need to tell it what to do. The first
thing is to set up any environment variables your service may need. You may or may not need to do this,
depending on the nature of your service. Let&rsquo;s say <code>myservice</code> needs Java to run, so we need to add the
<code>JRE_HOME</code> environment variable.</p>
<pre><code>export JRE_HOME=&quot;/usr/local&quot;
</code></pre>
<p>Excellent! Now it&rsquo;s time to tell service what to do when it uses particular commands. In this example, I&rsquo;ll
say we&rsquo;re using 3 commands: start, stop, and status. To do this, we set up a variable for each command,
where the value is the <code>sh</code> code to run. For complicated setups, you&rsquo;re best off setting this up to be an
independent file, or initializing these values as functions rather than variables. For the sake of
simplicity in the example, I&rsquo;m going to use quick <code>sh</code> one-liners. For reference, the variable names we use
are <code>start_cmd</code>, <code>stop_cmd</code>, and <code>status_cmd</code>. Also note, in this example I&rsquo;m assuming that <code>myservice</code>
starts as a daemon, and stores its PID in a file called <code>myservice.pid</code>.</p>
<pre><code>pidfile=&quot;/home/ericmiller/myservice/myservice.pid&quot;
start_cmd=&quot;/home/ericmiller/myservice/start ; echo MyService is now running on PID $(cat $pidfile)&quot;
stop_cmd=&quot;/home/ericmiller/myservice/stop ; echo MyService is not running. ; rm $(cat $pidfile)&quot;
status_cmd=&quot;if [ -e $pidfile ]; then echo MyService is running on PID $(cat $pidfile). ; return 1; fi; echo MyService is not running. ; return 0&quot;
</code></pre>
<p>Okay, we&rsquo;re almost done. Now we just need to tell rc.d to run the appropriate command based on the user&rsquo;s
input. This is done with the following line:</p>
<pre><code>run_rc_command &quot;$1&quot;
</code></pre>
<p>Okay! That&rsquo;s all you need for the script. Here&rsquo;s what our <code>/usr/local/etc/rc.d/myservice</code> script looks like:</p>
<pre><code>#!/bin/sh

. /etc/rc.subr

name=&quot;myservice&quot; # How the service will be invoked from service
rcvar=&quot;${name}_enable&quot; # The variable in rc.conf that will allow this service to run
load_rc_config $name # Loads the config file, if relevant.

export JRE_HOME=&quot;/usr/local&quot;

pidfile=&quot;/home/ericmiller/myservice/myservice.pid&quot;
start_cmd=&quot;/home/ericmiller/myservice/start ; echo MyService is now running on PID $(cat $pidfile)&quot;
stop_cmd=&quot;/home/ericmiller/myservice/stop ; echo MyService is not running. ; rm $(cat $pidfile)&quot;
status_cmd=&quot;if [ -e $pidfile ]; then echo MyService is running on PID $(cat $pidfile). ; return 1; fi; echo MyService is not running. ; return 0&quot;

run_rc_command &quot;$1&quot;
</code></pre>
<p>Now, there&rsquo;s one last step. If you try to run the service with <code>service start myservice</code>, it&rsquo;ll give you
a message telling you that you need to enable it in <code>/etc/rc.conf</code>. You can do this with one simple command:</p>
<pre><code>echo myservice_enable=&quot;YES&quot; &gt;&gt; /etc/rc.conf
</code></pre>
<p>Congrats! Your rc.d script is set up and ready to go.</p>

    </section>
    <footer class="pt-8">
      
  <div class="flex">
    
      <img class="w-24 h-24 !mt-0 !mb-0 mr-4 rounded-full" src="/images/ericmiller.png" />
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-400 dark:text-neutral-500 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Eric Miller
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">DevOps Engineer, Kuberneter</div>
      
      
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/sosheskaz/"
          target="_blank"
          alt="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
  </span>

</a
        >
      
    
  </div>


    </div>
  </div>


      

      
  
    <div class="pt-8 article-pagination">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex" href="/2017/03/29/AES-Security-Paper/">
              <span class="mr-3 article-pagination-direction">&larr;</span>
              <span class="flex flex-col">
                <span class="article-pagination-title mt-[0.1rem] leading-6"
                  >On the AES Encryption Algorithm</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-400 dark:text-neutral-500">
                  
                    <time datetime="2017-03-29 00:00:00 &#43;0000 UTC">29 March 2017</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right" href="/2017/03/23/Apple-Press-Release-Coverage/">
              <span class="flex flex-col">
                <span class="article-pagination-title mt-[0.1rem] leading-6"
                  >March 21 2017 Apple Press Release Coverage</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-400 dark:text-neutral-500">
                  
                    <time datetime="2017-03-23 00:00:00 &#43;0000 UTC">23 March 2017</time>
                  
                </span>
              </span>
              <span class="ml-3 article-pagination-direction">&rarr;</span>
            </a>
          
        </span>
      </div>
    </div>
  


    </footer>
    
  </article>
</main><footer class="py-10">
  
  
  <div class="flex justify-between">
    <div>
      
      <p class="text-sm text-neutral-400 dark:text-neutral-500">
          &copy;
          2022
          Eric Miller
      </p>
      
      
        <p class="text-xs text-neutral-300 dark:text-neutral-600">
          
          
          Powered by <a class="hover:underline hover:underline-primary-300 hover:text-primary-400"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:underline-primary-300 hover:text-primary-400" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div class="text-sm cursor-pointer text-neutral-400 dark:text-neutral-500">
        <button
          id="dark-toggle"
          onclick="setPreferredAppearance('dark');"
          oncontextmenu="setPreferredAppearance('default'); return false;"
          class="inline px-2 py-1 border rounded-md border-neutral-200 dark:hidden hover:text-primary-500 hover:border-primary-400"
          title="Switch to dark appearance"
        >
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg>
  </span>


        </button>
        <button
          id="light-toggle"
          onclick="setPreferredAppearance('light');"
          oncontextmenu="setPreferredAppearance('default'); return false;"
          class="hidden px-2 py-1 border rounded-md cursor-pointer dark:inline border-neutral-700 hover:text-primary-400 hover:border-primary-500"
          title="Switch to light appearance"
        >
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"></path></svg>
  </span>


        </button>
      </div>
    
  </div>
  
  
</footer>
</body>
</html>
